<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Learning Platform</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: {
              50: '#f0f9ff',
              100: '#e0f2fe',
              500: '#0284c7',
              600: '#0369a1',
              700: '#075985',
            },
            brand: {
              purple: '#a435f0',
              dark: '#2d2f31',
              light: '#1e1e1c',
            }
          },
        },
      },
    }
  </script>
  <style>
    .course-card {
      transition: all 0.2s ease-in-out;
      display: flex;
      flex-direction: column;
    }
    .course-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
    }
    .progress-bar-animated {
      background-size: 30px 30px;
      background-image: linear-gradient(
        45deg,
        rgba(255, 255, 255, 0.15) 25%,
        transparent 25%,
        transparent 50%,
        rgba(255, 255, 255, 0.15) 50%,
        rgba(255, 255, 255, 0.15) 75%,
        transparent 75%,
        transparent
      );
      animation: progress-bar-stripes 1s linear infinite;
    }
    @keyframes progress-bar-stripes {
      from { background-position: 30px 0; }
      to { background-position: 0 0; }
    }
    .lesson-button:hover .lesson-icon {
      transform: translateX(4px);
    }
    .lesson-icon {
      transition: transform 0.2s ease;
    }

    /* Custom scrollbar styles */
    .overflow-y-auto::-webkit-scrollbar {
      width: 6px;
      display: block; /* Ensure scrollbar is always visible */
    }

    .overflow-y-auto::-webkit-scrollbar-track {
      background: #f3f4f6;
      border-radius: 8px;
    }

    .overflow-y-auto::-webkit-scrollbar-thumb {
      background-color: #d1d5db;
      border-radius: 8px;
    }

    .overflow-y-auto::-webkit-scrollbar-thumb:hover {
      background-color: #a435f0;
    }

    /* Add this new class to force scrollbars to display */
    .scrollbar-visible {
      overflow-y: scroll !important; /* Force showing scrollbar */
      scrollbar-width: thin !important;
      scrollbar-color: #a435f0 #f3f4f6 !important;
    }

    /* Ensure webkit browsers also show scrollbars */
    .scrollbar-visible::-webkit-scrollbar {
      width: 6px !important;
      display: block !important; /* Ensure scrollbar is always visible */
    }

    .scrollbar-visible::-webkit-scrollbar-track {
      background: #f3f4f6 !important;
      border-radius: 8px !important;
    }

    .scrollbar-visible::-webkit-scrollbar-thumb {
      background-color: #d1d5db !important;
      border-radius: 8px !important;
    }

    .scrollbar-visible::-webkit-scrollbar-thumb:hover {
      background-color: #a435f0 !important;
    }

    /* Force scrollbar to always show */
    .always-show-scrollbar {
      overflow-y: scroll !important;
      height: 12rem !important;
      min-height: 12rem !important;
      border: 1px solid #e5e7eb !important;
      border-radius: 0.375rem !important;
      padding: 0.5rem !important;
    }

    /* For WebKit browsers (Chrome, Safari, Edge) */
    .always-show-scrollbar::-webkit-scrollbar {
      width: 6px !important;
      display: block !important;
    }

    .always-show-scrollbar::-webkit-scrollbar-track {
      background: #f3f4f6 !important;
      border-radius: 6px !important;
    }

    .always-show-scrollbar::-webkit-scrollbar-thumb {
      background: #a435f0 !important;
      border-radius: 6px !important;
    }

    /* For Firefox */
    .always-show-scrollbar {
      scrollbar-width: thin !important;
      scrollbar-color: #a435f0 #f3f4f6 !important;
    }

    /* Sidebar collapse/expand styles */
    #sidebar {
      transition: width 0.3s ease, min-width 0.3s ease;
      overflow-x: hidden;
    }
    
    #sidebar.collapsed {
      width: 0 !important;
      min-width: 0 !important;
      border-right: none;
    }
    
    /* Toggle button to reopen sidebar when collapsed */
    #expandButton {
      position: fixed;
      left: 0;
      top: 5rem;
      background: white;
      padding: 0.75rem 0.5rem;
      border-radius: 0 0.25rem 0.25rem 0;
      box-shadow: 2px 0 5px rgba(0,0,0,0.1);
      z-index: 40;
      display: none;
    }
    
    #expandButton.visible {
      display: block;
    }
  </style>
</head>
<body class="bg-gray-50 min-h-screen font-sans">
  <!-- Top Navigation -->
  <nav class="bg-white shadow-sm border-b border-gray-200">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex justify-between h-16">
        <div class="flex items-center">
          <span id="brandLogo" class="text-2xl font-bold text-brand-purple">
            <i class="fas fa-graduation-cap mr-2"></i>
            <span id="navTitle">Learning Platform</span>
          </span>
        </div>
        
        <div class="flex items-center">
          <button class="ml-4 p-2 rounded-full hover:bg-gray-100">
            <i class="fas fa-user-circle text-gray-500 text-xl"></i>
          </button>
        </div>
      </div>
    </div>
  </nav>

  <!-- Add this after your navigation and before the main content div -->
  <button id="expandButton" class="text-gray-500 hover:text-brand-purple">
    <i class="fas fa-chevron-right"></i>
  </button>

  <!-- Main Content with Sidebar -->
  <div class="max-w-7xl mx-auto flex">
    <!-- Left Sidebar -->
    <div id="sidebar" class="w-64 bg-white border-r border-gray-200 h-[calc(100vh-4rem)] sticky top-16 overflow-y-auto">
      <!-- Add this toggle button at the top -->
      <div class="flex justify-end p-2">
        <button id="sidebarToggle" class="text-gray-500 hover:text-brand-purple p-1 rounded-md">
          <i class="fas fa-chevron-left"></i>
        </button>
      </div>
      
      <div class="p-4">
        <h3 class="text-sm font-semibold text-gray-500 uppercase tracking-wider mb-3">
          Navigation
        </h3>

        <!-- Navigation Links -->
        <div class="space-y-2">
          <button id="showAllCoursesBtn" class="flex items-center w-full px-3 py-2 text-gray-900 rounded-md hover:bg-gray-100 group active-nav-item">
            <i class="fas fa-book-open mr-3 text-brand-purple"></i>
            <span class="font-medium">All Courses</span>
          </button>
          
          <button id="showMyProgressBtn" class="flex items-center w-full px-3 py-2 text-gray-600 rounded-md hover:bg-gray-100 group">
            <i class="fas fa-chart-line mr-3 text-gray-400"></i>
            <span class="font-medium">My Progress</span>
          </button>
        </div>
      </div>

      <!-- Course Tree List -->
      <div id="courseTree" class="mt-4 border-t border-gray-200 pt-4">
        <h3 class="px-4 mb-2 text-sm font-semibold text-gray-500 uppercase tracking-wider">
          All Courses
        </h3>
        <ul class="space-y-1 px-2">
          <!-- Course list will be generated here -->
        </ul>
      </div>
    </div>

    <!-- Main Content Area -->
    <div class="flex-1 p-6">
      <!-- Content Pages - Only one will be shown at a time -->
      
      <!-- All Courses Page -->
      <div id="allCoursesPage" class="block">
        <div class="mb-8 border-b border-gray-200 pb-4">
          <h1 id="platformTitle" class="text-3xl font-bold text-gray-900 mb-2">My Courses</h1>
          <div class="flex items-center justify-between flex-wrap gap-4">
            <p class="text-gray-600">Continue learning where you left off</p>
            
            <!-- Add search bar here -->
            <div class="relative w-full max-w-md">
              <input 
                id="searchInput" 
                type="text" 
                placeholder="Search for courses or lessons..." 
                class="w-full py-2 pl-10 pr-4 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-brand-purple focus:border-transparent"
              >
              <div class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none">
                <i class="fas fa-search text-gray-400"></i>
              </div>
              <button id="clearSearch" class="absolute inset-y-0 right-0 flex items-center pr-3 text-gray-400 hover:text-gray-600 hidden">
                <i class="fas fa-times"></i>
              </button>
            </div>
          </div>
        </div>
        
        <div id="courses" class="grid grid-cols-1 md:grid-cols-2 gap-8"></div>
      </div>
      
      <!-- My Progress Page -->
      <div id="myProgressPage" class="hidden">
        <div class="mb-8 border-b border-gray-200 pb-4">
          <h1 class="text-3xl font-bold text-gray-900">My Learning Progress</h1>
          <p class="mt-2 text-gray-600">Track your course completion and achievements</p>
        </div>
        
        <div id="progressStats" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
          <!-- Progress statistics cards -->
          <div class="bg-white p-6 rounded-lg shadow border border-gray-200">
            <div class="flex items-center justify-between">
              <div>
                <p class="text-sm font-medium text-gray-500">Courses in Progress</p>
                <h3 id="coursesInProgressCount" class="text-3xl font-bold text-gray-900">0</h3>
              </div>
              <div class="bg-blue-100 p-3 rounded-full">
                <i class="fas fa-book text-blue-500 text-xl"></i>
              </div>
            </div>
          </div>
          
          <div class="bg-white p-6 rounded-lg shadow border border-gray-200">
            <div class="flex items-center justify-between">
              <div>
                <p class="text-sm font-medium text-gray-500">Lessons Completed</p>
                <h3 id="lessonsCompletedCount" class="text-3xl font-bold text-gray-900">0</h3>
              </div>
              <div class="bg-green-100 p-3 rounded-full">
                <i class="fas fa-check-circle text-green-500 text-xl"></i>
              </div>
            </div>
          </div>
          
          <div class="bg-white p-6 rounded-lg shadow border border-gray-200">
            <div class="flex items-center justify-between">
              <div>
                <p class="text-sm font-medium text-gray-500">Overall Progress</p>
                <h3 id="overallProgressPercent" class="text-3xl font-bold text-gray-900">0%</h3>
              </div>
              <div class="bg-purple-100 p-3 rounded-full">
                <i class="fas fa-chart-pie text-brand-purple text-xl"></i>
              </div>
            </div>
          </div>
        </div>
        
        <div id="courseProgressList" class="space-y-6">
          <!-- Course progress details will be rendered here -->
        </div>
      </div>
    </div>
  </div>

  <!-- Video Modal -->
  <div id="videoModal" class="fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center hidden z-50">
    <div class="bg-white rounded-lg w-full max-w-4xl shadow-2xl overflow-hidden">
      <div class="bg-gray-100 border-b border-gray-200 px-6 py-4 flex justify-between items-center">
        <h2 id="lessonTitle" class="text-xl font-bold text-gray-800 truncate"></h2>
        <button onclick="closeVideo()" class="text-gray-500 hover:text-red-600 focus:outline-none">
          <i class="fas fa-times text-xl"></i>
        </button>
      </div>
      
      <div id="videoContainer" class="p-6">
        <!-- Regular video player (for MP4) -->
        <video id="lessonVideo" class="w-full rounded-lg shadow-lg hidden" controls></video>
        
        <!-- YouTube iframe (for YouTube videos) -->
        <div id="youtubeContainer" class="relative pt-0 w-full hidden">
          <div id="youtubePlayer" class="w-full rounded-lg shadow-lg aspect-video"></div>
        </div>
      </div>
      
      <div class="bg-gray-50 border-t border-gray-200 px-6 py-4 flex justify-between">
        <button id="restartButton" onclick="restartLesson()" 
                class="flex items-center bg-gray-200 hover:bg-gray-300 text-gray-700 px-6 py-3 rounded-md font-medium opacity-50 cursor-not-allowed" disabled>
          <i class="fas fa-redo mr-2"></i>
          Restart Lesson
        </button>
        <button id="markCompletedButton" onclick="markCompleted()" 
                class="flex items-center bg-brand-purple hover:bg-purple-700 text-white px-6 py-3 rounded-md font-medium">
          <i class="fas fa-check-circle mr-2"></i>
          Mark as Completed
        </button>
      </div>
    </div>
  </div>

  <script>
    // Configuration object with full YouTube URLs
    const platformConfig = {
      title: "Learning Platform",
      pageTitle: "My Learning",
      courses: [
        {
          id: "course-1",
          title: "Python Basics",
          description: "Learn the fundamentals of Python programming with hands-on projects and exercises.",
          image: "https://images.unsplash.com/photo-1649180556628-9ba704115795?q=80&w=3262&auto=format&fit=crop&ixlib=rb-4.0.3",
          instructor: "Alex Johnson",
          duration: "8 hours",
          lessons: [
            { 
              id: "lesson-1", 
              title: "Introduction to Python", 
              videoUrl: "https://www.youtube.com/watch?v=K5KVEU3aaeQ"  // Full YouTube URL
            },
            { 
              id: "lesson-2", 
              title: "Variables and Data Types", 
              videoUrl: "https://www.youtube.com/watch?v=QXeEoD0pB3E"  // Full YouTube URL
            },
            { 
              id: "lesson-3", 
              title: "Control Flow and Loops", 
              videoUrl: "https://www.youtube.com/watch?v=6iF8Xb7Z3wQ"  // Full YouTube URL
            }
          ]
        },
        {
          id: "course-2",
          title: "JavaScript Essentials",
          description: "Master the basics of JavaScript including DOM manipulation, events, and modern ES6+ features.",
          image: "https://images.unsplash.com/photo-1579468118864-1b9ea3c0db4a?q=80&w=3270&auto=format&fit=crop&ixlib=rb-4.0.3",
          instructor: "Maria Garcia",
          duration: "6.5 hours",
          lessons: [
            { 
              id: "lesson-4", 
              title: "JavaScript Fundamentals", 
              videoUrl: "https://sample-videos.com/video321/mp4/720/big_buck_bunny_720p_1mb.mp4" 
            },
            { 
              id: "lesson-5", 
              title: "Working with the DOM", 
              videoUrl: "https://sample-videos.com/video321/mp4/720/big_buck_bunny_720p_1mb.mp4" 
            }
          ]
        }
      ]
    };

    // Enrollment functions
    let enrollmentCache = null;

    function getEnrollmentCache() {
      if (!enrollmentCache) {
        enrollmentCache = JSON.parse(localStorage.getItem('enrolledCourses') || "[]");
      }
      return enrollmentCache;
    }

    function saveEnrollmentCache() {
      localStorage.setItem('enrolledCourses', JSON.stringify(enrollmentCache));
    }

    function checkEnrollmentStatus(courseId) {
      return getEnrollmentCache().includes(courseId);
    }

    function enrollInCourse(courseId) {
      const enrollments = getEnrollmentCache();
      if (!enrollments.includes(courseId)) {
        enrollments.push(courseId);
        saveEnrollmentCache();
        
        // Show success message
        showToast(`You've successfully enrolled in the course!`, 'success');
        
        // Re-render courses to update UI
        renderCourses();
      }
    }

    function unenrollFromCourse(courseId) {
      const enrollments = getEnrollmentCache();
      const index = enrollments.indexOf(courseId);
      
      if (index !== -1) {
        // Ask for confirmation before unenrolling
        if (confirm("Are you sure you want to unenroll from this course? Your progress will be preserved, but the course will be removed from your active courses.")) {
          enrollments.splice(index, 1);
          saveEnrollmentCache();
          
          // Show message
          showToast('You have unenrolled from the course.', 'info');
          
          // Re-render courses to update UI
          renderCourses();
        }
      }
    }

    // Toast notification function
    function showToast(message, type = 'info') {
      // Remove any existing toasts
      const existingToast = document.getElementById('toast');
      if (existingToast) {
        existingToast.remove();
      }
      
      // Create toast element
      const toast = document.createElement('div');
      toast.id = 'toast';
      toast.className = `fixed bottom-4 right-4 p-4 rounded-lg shadow-lg z-50 transform transition-all duration-300 ease-in-out translate-y-0`;
      
      // Set color based on type
      if (type === 'success') {
        toast.classList.add('bg-green-500', 'text-white');
      } else if (type === 'error') {
        toast.classList.add('bg-red-500', 'text-white');
      } else if (type === 'warning') {
        toast.classList.add('bg-yellow-500', 'text-white');
      } else {
        toast.classList.add('bg-blue-500', 'text-white');
      }
      
      // Add message and icon
      let icon = '';
      if (type === 'success') icon = '<i class="fas fa-check-circle mr-2"></i>';
      else if (type === 'error') icon = '<i class="fas fa-exclamation-circle mr-2"></i>';
      else if (type === 'warning') icon = '<i class="fas fa-exclamation-triangle mr-2"></i>';
      else icon = '<i class="fas fa-info-circle mr-2"></i>';
      
      toast.innerHTML = `<div class="flex items-center">${icon} ${message}</div>`;
      
      // Add to DOM
      document.body.appendChild(toast);
      
      // Remove after 3 seconds
      setTimeout(() => {
        toast.classList.add('opacity-0', 'translate-y-2');
        setTimeout(() => toast.remove(), 300);
      }, 3000);
    }

    // Function to extract YouTube video ID from URL
    function extractYouTubeVideoId(url) {
      if (!url) return null;
      
      // Handle different YouTube URL formats
      const regExp = /^.*((youtu.be\/)|(v\/)|(\/u\/\w\/)|(embed\/)|(watch\?))\??v?=?([^#&?]*).*/;
      const match = url.match(regExp);
      
      return (match && match[7].length === 11) ? match[7] : null;
    }

    // Function to check if URL is a YouTube URL
    function isYouTubeUrl(url) {
      return url && (
        url.includes('youtube.com') || 
        url.includes('youtu.be') ||
        url.includes('youtube-nocookie.com')
      );
    }

    // Load YouTube API asynchronously
    function loadYoutubeAPI() {
      if (window.YT) return Promise.resolve(); // API already loaded
      
      return new Promise((resolve) => {
        const tag = document.createElement('script');
        tag.src = "https://www.youtube.com/iframe_api";
        const firstScriptTag = document.getElementsByTagName('script')[0];
        firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
        
        // When API is ready
        window.onYouTubeIframeAPIReady = function() {
          resolve();
        };
      });
    }

    // Global reference to YouTube player
    let youtubePlayer = null;
    // Variable to store YouTube progress tracking interval
    let youtubeProgressInterval = null;

    // Caching for localStorage
    let progressCache = null;
    let completedCache = null;
    let currentLessonId = "";
    
    // Reference to courses from config
    const courses = platformConfig.courses;

    // Event handlers
    function handleTimeUpdate() {
      const video = document.getElementById('lessonVideo');
      if (video && video.duration) {
        const ratio = computeRatio(video);
        storeProgress(currentLessonId, ratio);
      }
    }

    function handlePause() {
      const video = document.getElementById('lessonVideo');
      if (video && video.duration) {
        const ratio = computeRatio(video);
        storeProgress(currentLessonId, ratio);
      }
    }

    function renderCourses() {
      const container = document.getElementById('courses');
      container.innerHTML = '';

      // Use DocumentFragment for better performance
      const fragment = document.createDocumentFragment();

      courses.forEach(course => {
        fragment.appendChild(createCourseCard(course));
      });

      container.appendChild(fragment);
    }

    function createCourseCard(course) {
      const courseCard = document.createElement('div');
      courseCard.className = "bg-white rounded-lg shadow-md overflow-hidden flex flex-col course-card border border-gray-200";
      courseCard.dataset.courseId = course.id;

      const completedLessons = getCompletedLessons(course);
      const progress = calculateCourseProgress(course);
      const isInProgress = progress > 0;
      const isEnrolled = checkEnrollmentStatus(course.id);
      
      const img = document.createElement('img');
      img.src = course.image;
      img.alt = course.title;
      img.className = "h-48 w-full object-cover";
      
      // Add enrollment badge if enrolled
      if (isEnrolled) {
        const enrolledBadge = document.createElement('div');
        enrolledBadge.className = "absolute top-2 right-2 bg-green-500 text-white text-xs px-2 py-1 rounded-full";
        enrolledBadge.innerHTML = '<i class="fas fa-user-check mr-1"></i>Enrolled';
        
        // Make img container relative for absolute positioning of badge
        const imgContainer = document.createElement('div');
        imgContainer.className = "relative";
        imgContainer.appendChild(img);
        imgContainer.appendChild(enrolledBadge);
        courseCard.appendChild(imgContainer);
      } else {
        courseCard.appendChild(img);
      }
      
      const content = document.createElement('div');
      content.className = "p-5 flex flex-col flex-1 border-t border-gray-100";
      
      // Title, instructor, duration, description code remains the same
      const title = document.createElement('h2');
      title.className = "text-xl font-bold mb-2 text-gray-800 leading-tight";
      title.textContent = course.title;
      
      const instructor = document.createElement('p');
      instructor.className = "text-sm text-gray-600 mb-1";
      instructor.innerHTML = `<i class="fas fa-user-tie mr-2"></i>${course.instructor}`;
      
      const duration = document.createElement('p');
      duration.className = "text-sm text-gray-600 mb-3";
      duration.innerHTML = `<i class="fas fa-clock mr-2"></i>${course.duration} total`;
      
      const desc = document.createElement('p');
      desc.className = "text-gray-700 text-sm mb-4 flex-grow";
      desc.textContent = course.description;
      
      // Enroll/Unenroll button
      const enrollButtonContainer = document.createElement('div');
      enrollButtonContainer.className = "mb-4";
      
      const enrollButton = document.createElement('button');
      
      if (isEnrolled) {
        enrollButton.className = "w-full py-2 px-4 bg-red-50 text-red-600 border border-red-200 rounded hover:bg-red-100 transition-colors";
        enrollButton.innerHTML = '<i class="fas fa-user-minus mr-2"></i>Unenroll';
        enrollButton.onclick = () => unenrollFromCourse(course.id);
      } else {
        enrollButton.className = "w-full py-2 px-4 bg-brand-purple text-white rounded hover:bg-purple-700 transition-colors";
        enrollButton.innerHTML = '<i class="fas fa-user-plus mr-2"></i>Enroll in Course';
        enrollButton.onclick = () => enrollInCourse(course.id);
      }
      
      enrollButtonContainer.appendChild(enrollButton);
      
      // Progress section - only show if enrolled
      const progressContainer = document.createElement('div');
      
      if (isEnrolled) {
        const progressLabel = document.createElement('div');
        progressLabel.className = "flex justify-between mb-1";
        
        const progressText = document.createElement('span');
        progressText.className = "text-sm font-medium text-gray-700";
        progressText.textContent = isInProgress ? "Continue learning" : "Start learning";
        
        const progressPercentage = document.createElement('span');
        progressPercentage.className = "text-sm font-medium text-gray-700";
        progressPercentage.textContent = `${progress.toFixed(0)}%`;
        
        progressLabel.appendChild(progressText);
        progressLabel.appendChild(progressPercentage);
        
        const progressBar = document.createElement('div');
        progressBar.className = "w-full bg-gray-200 rounded-full h-2.5";
        
        const progressFill = document.createElement('div');
        progressFill.className = `bg-brand-purple h-2.5 rounded-full ${progress > 0 && progress < 100 ? 'progress-bar-animated' : ''}`;
        progressFill.style.width = `${progress}%`;
        
        progressBar.appendChild(progressFill);
        progressContainer.appendChild(progressLabel);
        progressContainer.appendChild(progressBar);
        
        const stats = document.createElement('p');
        stats.className = "text-sm text-gray-500 mt-1 mb-4";
        stats.textContent = `${completedLessons.length} of ${course.lessons.length} lessons completed`;
        
        progressContainer.appendChild(stats);
        
        // Rest of the existing course card code for lessons...
        const divider = document.createElement('hr');
        divider.className = "border-gray-200 mb-4";
        
        const lessonsContainer = document.createElement('div');
        lessonsContainer.className = "relative";
        
        const lessonsHeader = document.createElement('div');
        lessonsHeader.className = "flex justify-between items-center mb-3";
        
        const lessonsTitle = document.createElement('h3');
        lessonsTitle.className = "font-semibold text-gray-700";
        lessonsTitle.textContent = "Course Content";
        
        const lessonsCount = document.createElement('span');
        lessonsCount.className = "text-xs text-gray-500";
        lessonsCount.textContent = `${course.lessons.length} lessons`;
        
        lessonsHeader.appendChild(lessonsTitle);
        lessonsHeader.appendChild(lessonsCount);
        
        const lessonsList = document.createElement('div');
        lessonsList.className = "space-y-2 pr-1 max-h-48 always-show-scrollbar";

        // Set fixed height and forced scrollbars with inline styles
        lessonsList.style.overflowY = "scroll";
        lessonsList.style.height = "12rem";
        lessonsList.style.border = "1px solid #e5e7eb";
        lessonsList.style.borderRadius = "0.375rem";
        lessonsList.style.padding = "0.5rem";

        // Force Firefox scrollbar
        lessonsList.style.scrollbarWidth = "thin";
        lessonsList.style.scrollbarColor = "#a435f0 #f3f4f6";

        // Add lessons to demonstrate scrolling
        course.lessons.forEach(lesson => {
          lessonsList.appendChild(createLessonButton(lesson, isEnrolled));
        });

        // For browsers that don't show scrollbars by default
        if (course.lessons.length < 3) {
          const spacer = document.createElement('div');
          spacer.style.height = "4rem";
          lessonsList.appendChild(spacer);
        }
        
        lessonsContainer.appendChild(lessonsHeader);
        lessonsContainer.appendChild(lessonsList);
        
        content.appendChild(title);
        content.appendChild(instructor);
        content.appendChild(duration);
        content.appendChild(desc);
        content.appendChild(enrollButtonContainer);
        content.appendChild(divider);
        content.appendChild(progressContainer);
        content.appendChild(lessonsContainer);
      } else {
        // For non-enrolled courses, show minimal info
        content.appendChild(title);
        content.appendChild(instructor);
        content.appendChild(duration);
        content.appendChild(desc);
        content.appendChild(enrollButtonContainer);
        
        // Add a message that user needs to enroll
        const enrollMessage = document.createElement('div');
        enrollMessage.className = "text-center bg-gray-50 p-4 rounded-md border border-gray-100 mt-2";
        enrollMessage.innerHTML = '<i class="fas fa-lock text-gray-400 mb-2 text-lg"></i><p class="text-gray-500 text-sm">Enroll to access course content</p>';
        content.appendChild(enrollMessage);
      }
      
      courseCard.appendChild(content);
      
      return courseCard;
    }

    function calculateCourseProgress(course) {
      let totalProgress = 0;
      course.lessons.forEach(lesson => {
        if (isCompleted(lesson.id)) {
          totalProgress += 1;
        } else {
          totalProgress += getStoredProgress(lesson.id) || 0;
        }
      });
      
      return (totalProgress / course.lessons.length) * 100;
    }

    function createLessonButton(lesson, isEnrolled = true) {
      const isDone = isCompleted(lesson.id);
      const lessonProgress = (getStoredProgress(lesson.id) || 0) * 100;
      const isStarted = lessonProgress > 0 && !isDone;
      
      const button = document.createElement('button');
      button.className = `flex items-center justify-between w-full text-left p-3 rounded-lg transition-colors lesson-button
        ${isDone ? 'bg-green-50 text-green-800 hover:bg-green-100' : 
                  isStarted ? 'bg-blue-50 text-blue-800 hover:bg-blue-100' : 
                  'bg-gray-50 hover:bg-gray-100 text-gray-800'}`;
      button.dataset.lessonId = lesson.id;
      
      const leftSide = document.createElement('div');
      leftSide.className = "flex items-center";
      
      let icon;
      if (isDone) {
        icon = '<i class="fas fa-check-circle text-green-500 mr-3"></i>';
      } else if (isStarted) {
        icon = '<i class="fas fa-play-circle text-blue-500 mr-3"></i>';
      } else {
        icon = '<i class="fas fa-circle text-gray-300 mr-3"></i>';
      }
      
      leftSide.innerHTML = icon + `<span>${lesson.title}</span>`;
      
      const rightSide = document.createElement('div');
      rightSide.className = "flex items-center";
      
      const progressText = document.createElement('span');
      progressText.className = "text-xs mr-2";
      if (isDone) {
        progressText.textContent = "Completed";
        progressText.className += " text-green-600";
      } else if (isStarted) {
        progressText.textContent = `${lessonProgress.toFixed(0)}%`;
        progressText.className += " text-blue-600";
      }
      
      const arrowIcon = document.createElement('span');
      arrowIcon.className = "lesson-icon text-gray-400";
      arrowIcon.innerHTML = '<i class="fas fa-chevron-right"></i>';
      
      rightSide.appendChild(progressText);
      rightSide.appendChild(arrowIcon);
      
      button.appendChild(leftSide);
      button.appendChild(rightSide);
      
      if (isEnrolled) {
        button.onclick = () => openVideo(lesson);
      } else {
        button.disabled = true;
        button.classList.add('opacity-50', 'cursor-not-allowed');
        button.onclick = (e) => {
          e.preventDefault();
          alert('Please enroll in this course to access lessons');
        };
      }
      
      return button;
    }

    function openVideo(lesson) {
      currentLessonId = lesson.id;
      document.getElementById('lessonTitle').textContent = lesson.title;
      
      // Show modal first (needed for YouTube player initialization)
      document.getElementById('videoModal').classList.remove('hidden');
      
      const videoElement = document.getElementById('lessonVideo');
      const youtubeContainer = document.getElementById('youtubeContainer');
      
      // Clean up existing players/listeners
      videoElement.removeEventListener('timeupdate', handleTimeUpdate);
      videoElement.removeEventListener('pause', handlePause);
      videoElement.removeEventListener('timeupdate', updateButtonStates);
      
      // Hide both containers initially
      videoElement.classList.add('hidden');
      youtubeContainer.classList.add('hidden');
      
      // Check if the URL is a YouTube URL
      if (isYouTubeUrl(lesson.videoUrl)) {
        // Extract the video ID from the URL
        const videoId = extractYouTubeVideoId(lesson.videoUrl);
        if (!videoId) {
          alert(`Invalid YouTube URL for lesson "${lesson.title}"`);
          closeVideo();
          return;
        }
        
        // Show YouTube container
        youtubeContainer.classList.remove('hidden');
        
        // Load YouTube API if needed
        loadYoutubeAPI().then(() => {
          // Get saved progress
          const savedProgress = getStoredProgress(lesson.id);
          const startSeconds = savedProgress > 0 ? Math.floor(savedProgress * 100) : 0; // Approximate for starting point
          
          // Create YouTube player or load new video if player exists
          if (youtubePlayer) {
            // Destroy the previous player first
            youtubePlayer.destroy();
            youtubePlayer = null;
          }

          // Create new player each time
          youtubePlayer = new YT.Player('youtubePlayer', {
            videoId: videoId,
            playerVars: {
              'autoplay': 1,
              'start': startSeconds,
              'modestbranding': 1,
              'rel': 0
            },
            events: {
              'onStateChange': onYouTubeStateChange,
              'onReady': function(event) {
                updateButtonStates();
              },
              'onError': function(event) {
                alert(`Error loading YouTube video for "${lesson.title}"`);
                closeVideo();
              }
            }
          });
        });
      } else {
        // Regular video - use existing code
        videoElement.classList.remove('hidden');
        videoElement.src = lesson.videoUrl;
        
        videoElement.onerror = function() {
          alert(`Sorry, there was an error loading the video for "${lesson.title}"`);
          closeVideo();
        };
        
        videoElement.addEventListener('loadedmetadata', function onMetadataLoaded() {
          const savedProgress = getStoredProgress(lesson.id);
          if (savedProgress > 0) {
            videoElement.currentTime = videoElement.duration * savedProgress;
          }
          videoElement.removeEventListener('loadedmetadata', onMetadataLoaded);
          updateButtonStates();
        });
        
        videoElement.addEventListener('timeupdate', handleTimeUpdate);
        videoElement.addEventListener('pause', handlePause);
        videoElement.addEventListener('timeupdate', updateButtonStates);
      }
    }

    // Handle YouTube player state changes
    function onYouTubeStateChange(event) {
      // Store progress periodically (every 5 seconds)
      if (event.data === YT.PlayerState.PLAYING) {
        if (youtubeProgressInterval) clearInterval(youtubeProgressInterval);
        
        youtubeProgressInterval = setInterval(() => {
          if (youtubePlayer && youtubePlayer.getCurrentTime) {
            const currentTime = youtubePlayer.getCurrentTime();
            const duration = youtubePlayer.getDuration();
            
            if (currentTime && duration) {
              const ratio = currentTime / duration;
              storeProgress(currentLessonId, ratio);
              updateButtonStates();
            }
          }
        }, 5000);
      } else if (event.data === YT.PlayerState.PAUSED || event.data === YT.PlayerState.ENDED) {
        // Store progress when paused or ended
        if (youtubePlayer && youtubePlayer.getCurrentTime) {
          const currentTime = youtubePlayer.getCurrentTime();
          const duration = youtubePlayer.getDuration();
          
          if (currentTime && duration) {
            const ratio = currentTime / duration;
            storeProgress(currentLessonId, ratio);
            updateButtonStates();
          }
        }
        
        // Clear interval when not playing
        if (youtubeProgressInterval) {
          clearInterval(youtubeProgressInterval);
          youtubeProgressInterval = null;
        }
      }
    }

    function closeVideo() {
      // Clean up YouTube player
      if (youtubeProgressInterval) {
        clearInterval(youtubeProgressInterval);
        youtubeProgressInterval = null;
      }
      
      // If YouTube player exists and is playing, store the progress
      if (youtubePlayer && youtubePlayer.getPlayerState) {
        try {
          if (youtubePlayer.getPlayerState() !== YT.PlayerState.UNSTARTED) {
            const currentTime = youtubePlayer.getCurrentTime();
            const duration = youtubePlayer.getDuration();
            
            if (currentTime && duration) {
              const ratio = currentTime / duration;
              storeProgress(currentLessonId, ratio);
            }
          }
          // Pause YouTube video to stop playback
          youtubePlayer.pauseVideo();
        } catch (e) {
          console.error("Error handling YouTube player:", e);
        }
      }
      
      // Handle regular video player
      const video = document.getElementById("lessonVideo");
      video.onerror = null;

      if (video.duration) {
        const ratio = computeRatio(video);
        storeProgress(currentLessonId, ratio);
      }
      
      video.removeEventListener('timeupdate', handleTimeUpdate);
      video.removeEventListener('pause', handlePause);
      video.removeEventListener('timeupdate', updateButtonStates);
      
      video.pause();
      video.src = "";
      
      document.getElementById("videoModal").classList.add("hidden");
      
      renderCourses();
    }

    function restartLesson() {
      // Reset progress in storage
      storeProgress(currentLessonId, 0);
      
      const videoElement = document.getElementById('lessonVideo');
      const youtubeContainer = document.getElementById('youtubeContainer');
      
      if (!youtubeContainer.classList.contains('hidden')) {
        // YouTube video is active
        if (youtubePlayer && youtubePlayer.seekTo) {
          youtubePlayer.seekTo(0);
          youtubePlayer.playVideo();
        }
      } else {
        // Regular video is active
        videoElement.currentTime = 0;
        videoElement.play();
      }
      
      updateButtonStates();
    }

    function computeRatio(video) {
      const computed = video.currentTime / video.duration;
      return Number.isFinite(computed) && computed >= 0 && computed <= 1 ? computed : 0;
    }

    function getProgressCache() {
      if (!progressCache) {
        progressCache = JSON.parse(localStorage.getItem('partialProgress') || "{}");
      }
      return progressCache;
    }

    function getCompletedCache() {
      if (!completedCache) {
        completedCache = JSON.parse(localStorage.getItem('completedLessons') || "[]");
      }
      return completedCache;
    }

    function saveProgressCache() {
      localStorage.setItem('partialProgress', JSON.stringify(progressCache));
    }

    function saveCompletedCache() {
      localStorage.setItem('completedLessons', JSON.stringify(completedCache));
    }

    function storeProgress(lessonId, ratio) {
      const cache = getProgressCache();
      cache[lessonId] = ratio;
      saveProgressCache();
    }

    function getStoredProgress(lessonId) {
      return getProgressCache()[lessonId] || 0;
    }

    function markCompleted() {
      const completed = getCompletedCache();
      if (!completed.includes(currentLessonId)) {
        completed.push(currentLessonId);
        saveCompletedCache();
      }
      closeVideo();
      renderCourses();
    }

    function isCompleted(lessonId) {
      const completed = getCompletedCache();
      const partials = getProgressCache();
      return completed.includes(lessonId) || (partials[lessonId] === 1);
    }

    function getCompletedLessons(course) {
      return course.lessons.filter(lesson => isCompleted(lesson.id));
    }

    function updateButtonStates() {
      const video = document.getElementById('lessonVideo');
      const youtubeContainer = document.getElementById('youtubeContainer');
      const progressRatio = getStoredProgress(currentLessonId);
      const completed = isCompleted(currentLessonId);
      
      let hasProgress = progressRatio > 0;
      
      // Check current time for both players
      if (!hasProgress) {
        if (!youtubeContainer.classList.contains('hidden')) {
          // YouTube is active
          if (youtubePlayer && youtubePlayer.getCurrentTime) {
            try {
              hasProgress = youtubePlayer.getCurrentTime() > 0;
            } catch (e) {
              console.error("Error getting YouTube time:", e);
            }
          }
        } else if (video && video.duration) {
          // Local video is active
          hasProgress = video.currentTime > 0;
        }
      }
      
      // Restart button: enable only if there's progress to reset
      const restartBtn = document.getElementById('restartButton');
      if (hasProgress) {
        restartBtn.disabled = false;
        restartBtn.classList.remove('opacity-50', 'cursor-not-allowed');
        restartBtn.classList.add('hover:bg-gray-300');
      } else {
        restartBtn.disabled = true;
        restartBtn.classList.add('opacity-50', 'cursor-not-allowed');
        restartBtn.classList.remove('hover:bg-gray-300');
      }
      
      // Mark completed button: disable if already at 100% or marked completed
      const completeBtn = document.getElementById('markCompletedButton');
      if (progressRatio === 1 || completed) {
        completeBtn.disabled = true;
        completeBtn.classList.add('opacity-50', 'cursor-not-allowed');
        completeBtn.classList.remove('hover:bg-purple-700');
        completeBtn.innerHTML = completed ? 
          '<i class="fas fa-check-double mr-2"></i>Lesson Completed' : 
          '<i class="fas fa-check mr-2"></i>Already at 100%';
      } else {
        completeBtn.disabled = false;
        completeBtn.classList.remove('opacity-50', 'cursor-not-allowed');
        completeBtn.classList.add('hover:bg-purple-700');
        completeBtn.innerHTML = '<i class="fas fa-check-circle mr-2"></i>Mark as Completed';
      }
    }

    // Search functionality
    function setupSearch() {
      const searchInput = document.getElementById('searchInput');
      const clearButton = document.getElementById('clearSearch');
      
      // Show/hide the clear button based on input content
      searchInput.addEventListener('input', function() {
        if (this.value.length > 0) {
          clearButton.classList.remove('hidden');
        } else {
          clearButton.classList.add('hidden');
        }
        
        performSearch(this.value.toLowerCase());
      });
      
      // Clear search when the X button is clicked
      clearButton.addEventListener('click', function() {
        searchInput.value = '';
        clearButton.classList.add('hidden');
        performSearch('');
        searchInput.focus();
      });
    }

    function performSearch(query) {
      // Get all course cards and reset them first
      const courseCards = document.querySelectorAll('.course-card');
      
      // If query is empty, show all courses
      if (!query) {
        courseCards.forEach(card => {
          card.classList.remove('hidden');
        });
        
        // Show the original heading
        document.getElementById('platformTitle').textContent = platformConfig.pageTitle;
        
        // Fixed: Check if the element exists before accessing its text content
        const subheadingElement = document.querySelector('.flex.items-center.justify-between.flex-wrap p.text-gray-600');
        if (subheadingElement) {
          subheadingElement.textContent = "Continue learning where you left off";
        }
        return;
      }
      
      // Update the heading to show search results
      document.getElementById('platformTitle').textContent = `Search results for "${query}"`;
      
      // Fixed: Update the subheading with the correct selector
      const subheadingElement = document.querySelector('.flex.items-center.justify-between.flex-wrap p.text-gray-600');
      if (subheadingElement) {
        subheadingElement.textContent = "Courses and lessons matching your search";
      }
      
      // Track matches to update the UI appropriately
      let matchCount = 0;
      
      // For each course, check if title, description, or any lesson title matches
      courseCards.forEach(card => {
        const courseTitle = card.querySelector('h2').textContent.toLowerCase();
        const courseDescription = card.querySelector('p.text-gray-700').textContent.toLowerCase();
        
        // Get all lesson buttons in this course
        const lessonButtons = card.querySelectorAll('button[data-lesson-id]');
        let hasMatchingLesson = false;
        
        // Check if any lesson title matches
        lessonButtons.forEach(button => {
          const lessonTitle = button.querySelector('span').textContent.toLowerCase();
          
          if (lessonTitle.includes(query)) {
            // Highlight matching lesson
            button.classList.add('ring-2', 'ring-brand-purple', 'ring-opacity-50');
            hasMatchingLesson = true;
          } else {
            // Remove highlight if not matching
            button.classList.remove('ring-2', 'ring-brand-purple', 'ring-opacity-50');
          }
        });
        
        // Show course if title, description or any lesson matches
        if (courseTitle.includes(query) || courseDescription.includes(query) || hasMatchingLesson) {
          card.classList.remove('hidden');
          matchCount++;
          
          // Add subtle highlight to course card if direct match
          if (courseTitle.includes(query) || courseDescription.includes(query)) {
            card.classList.add('ring-2', 'ring-brand-purple', 'ring-opacity-50');
          } else {
            card.classList.remove('ring-2', 'ring-brand-purple', 'ring-opacity-50');
          }
        } else {
          card.classList.add('hidden');
        }
      });
      
      // Update heading if no results found
      if (matchCount === 0) {
        document.getElementById('platformTitle').textContent = "No results found";
        
        // Fixed: Update no results message with the correct selector
        const subheadingElement = document.querySelector('.flex.items-center.justify-between.flex-wrap p.text-gray-600');
        if (subheadingElement) {
          subheadingElement.textContent = `No courses or lessons match "${query}"`;
        }
      }
    }

    function populateCourseTree() {
      const courseTreeList = document.querySelector('#courseTree ul');
      courseTreeList.innerHTML = '';
      
      courses.forEach(course => {
        const li = document.createElement('li');
        
        const courseButton = document.createElement('button');
        courseButton.className = "flex items-center w-full px-2 py-2 text-sm text-gray-600 rounded-md hover:bg-gray-100 group text-left";
        courseButton.innerHTML = `
          <i class="fas fa-graduation-cap mr-2 text-brand-purple"></i>
          <span class="truncate">${course.title}</span>
        `;
        
        courseButton.addEventListener('click', () => {
          // Scroll to the course card
          const courseCards = document.querySelectorAll('.course-card');
          courseCards.forEach(card => {
            if (card.dataset.courseId === course.id) {
              card.scrollIntoView({ behavior: 'smooth', block: 'center' });
              // Add highlight effect
              card.classList.add('ring-2', 'ring-brand-purple');
              setTimeout(() => {
                card.classList.remove('ring-2', 'ring-brand-purple');
              }, 2000);
            }
          });
          
          // Make sure we're on the courses page
          showAllCourses();
        });
        
        li.appendChild(courseButton);
        courseTreeList.appendChild(li);
      });
    }
    
    function renderProgressPage() {
      // Count courses in progress
      let coursesInProgress = 0;
      let lessonsCompleted = 0;
      let totalLessons = 0;
      
      // Get enrolled courses
      const enrolledCourseIds = getEnrollmentCache();
      
      // Reset the progress list
      const courseProgressList = document.getElementById('courseProgressList');
      courseProgressList.innerHTML = '';
      
      // Check if user has any enrolled courses
      if (enrolledCourseIds.length === 0) {
        // Show message when no courses are enrolled
        const noCourseMessage = document.createElement('div');
        noCourseMessage.className = "bg-white p-8 rounded-lg shadow text-center";
        noCourseMessage.innerHTML = `
          <div class="text-gray-400 mb-4"><i class="fas fa-book-reader text-5xl"></i></div>
          <h3 class="text-xl font-semibold text-gray-700 mb-2">No Enrolled Courses</h3>
          <p class="text-gray-500 mb-4">You haven't enrolled in any courses yet.</p>
          <button id="browseCourses" class="bg-brand-purple hover:bg-purple-700 text-white px-6 py-2 rounded-md">
            Browse Courses
          </button>
        `;
        
        courseProgressList.appendChild(noCourseMessage);
        
        // Add click event to the button
        document.getElementById('browseCourses').addEventListener('click', showAllCourses);
        
        // Update stats with zeros
        document.getElementById('coursesInProgressCount').textContent = 0;
        document.getElementById('lessonsCompletedCount').textContent = 0;
        document.getElementById('overallProgressPercent').textContent = "0%";
        
        return;
      }
      
      // Process each enrolled course
      courses.forEach(course => {
        // Skip courses that user is not enrolled in
        if (!enrolledCourseIds.includes(course.id)) {
          return;
        }
        
        totalLessons += course.lessons.length;
        
        const completedLessons = getCompletedLessons(course);
        lessonsCompleted += completedLessons.length;
        
        const progress = calculateCourseProgress(course);
        if (progress > 0 && progress < 100) {
          coursesInProgress++;
        }
        
        // Create course progress card
        const courseCard = document.createElement('div');
        courseCard.className = "bg-white p-6 rounded-lg shadow border border-gray-200";
        
        const header = document.createElement('div');
        header.className = "flex justify-between items-center mb-4";
        
        const title = document.createElement('h3');
        title.className = "text-lg font-bold text-gray-800";
        title.textContent = course.title;
        
        const progressText = document.createElement('span');
        progressText.className = "text-sm font-medium";
        
        if (progress === 100) {
          progressText.className += " text-green-600";
          progressText.textContent = "Completed";
        } else if (progress > 0) {
          progressText.className += " text-blue-600";
          progressText.textContent = `${progress.toFixed(0)}% complete`;
        } else {
          progressText.className += " text-gray-500";
          progressText.textContent = "Not started";
        }
        
        header.appendChild(title);
        header.appendChild(progressText);
        
        const progressBarContainer = document.createElement('div');
        progressBarContainer.className = "w-full bg-gray-200 rounded-full h-2.5 mb-4";
        
        const progressFill = document.createElement('div');
        progressFill.className = `bg-brand-purple h-2.5 rounded-full ${progress > 0 && progress < 100 ? 'progress-bar-animated' : ''}`;
        progressFill.style.width = `${progress}%`;
        
        progressBarContainer.appendChild(progressFill);
        
        const lessonList = document.createElement('div');
        lessonList.className = "mt-4 space-y-2 text-sm";
        
        course.lessons.forEach(lesson => {
          const isDone = isCompleted(lesson.id);
          const lessonProgress = (getStoredProgress(lesson.id) || 0) * 100;
          
          const lessonRow = document.createElement('div');
          lessonRow.className = "flex items-center justify-between";
          
          const lessonTitle = document.createElement('div');
          lessonTitle.className = "flex items-center";
          
          if (isDone) {
            lessonTitle.innerHTML = `<i class="fas fa-check-circle text-green-500 mr-2"></i> ${lesson.title}`;
          } else if (lessonProgress > 0) {
            lessonTitle.innerHTML = `<i class="fas fa-play-circle text-blue-500 mr-2"></i> ${lesson.title}`;
          } else {
            lessonTitle.innerHTML = `<i class="fas fa-circle text-gray-300 mr-2"></i> ${lesson.title}`;
          }
          
          const lessonStatus = document.createElement('div');
          if (isDone) {
            lessonStatus.className = "text-green-600";
            lessonStatus.textContent = "Completed";
          } else if (lessonProgress > 0) {
            lessonStatus.className = "text-blue-600";
            lessonStatus.textContent = `${lessonProgress.toFixed(0)}%`;
          } else {
            lessonStatus.className = "text-gray-500";
            lessonStatus.textContent = "Not started";
          }
          
          lessonRow.appendChild(lessonTitle);
          lessonRow.appendChild(lessonStatus);
          
          lessonList.appendChild(lessonRow);
        });
        
        courseCard.appendChild(header);
        courseCard.appendChild(progressBarContainer);
        courseCard.appendChild(lessonList);
        
        courseProgressList.appendChild(courseCard);
      });
      
      // Update stats
      document.getElementById('coursesInProgressCount').textContent = coursesInProgress;
      document.getElementById('lessonsCompletedCount').textContent = lessonsCompleted;
      
      const overallPercent = totalLessons > 0 ? ((lessonsCompleted / totalLessons) * 100).toFixed(0) : 0;
      document.getElementById('overallProgressPercent').textContent = `${overallPercent}%`;
    }
    
    function showAllCourses() {
      // Update active state in nav
      document.getElementById('showAllCoursesBtn').classList.add('active-nav-item', 'text-gray-900');
      document.getElementById('showAllCoursesBtn').classList.remove('text-gray-600');
      document.getElementById('showAllCoursesBtn').querySelector('i').classList.add('text-brand-purple');
      document.getElementById('showAllCoursesBtn').querySelector('i').classList.remove('text-gray-400');
      
      document.getElementById('showMyProgressBtn').classList.remove('active-nav-item', 'text-gray-900');
      document.getElementById('showMyProgressBtn').classList.add('text-gray-600');
      document.getElementById('showMyProgressBtn').querySelector('i').classList.remove('text-brand-purple');
      document.getElementById('showMyProgressBtn').querySelector('i').classList.add('text-gray-400');
      
      // Show/hide pages
      document.getElementById('allCoursesPage').classList.remove('hidden');
      document.getElementById('allCoursesPage').classList.add('block');
      document.getElementById('myProgressPage').classList.remove('block');
      document.getElementById('myProgressPage').classList.add('hidden');
    }
    
    function showMyProgress() {
      // Update active state in nav
      document.getElementById('showMyProgressBtn').classList.add('active-nav-item', 'text-gray-900');
      document.getElementById('showMyProgressBtn').classList.remove('text-gray-600');
      document.getElementById('showMyProgressBtn').querySelector('i').classList.add('text-brand-purple');
      document.getElementById('showMyProgressBtn').querySelector('i').classList.remove('text-gray-400');
      
      document.getElementById('showAllCoursesBtn').classList.remove('active-nav-item', 'text-gray-900');
      document.getElementById('showAllCoursesBtn').classList.add('text-gray-600');
      document.getElementById('showAllCoursesBtn').querySelector('i').classList.remove('text-brand-purple');
      document.getElementById('showAllCoursesBtn').querySelector('i').classList.add('text-gray-400');
      
      // Show/hide pages
      document.getElementById('myProgressPage').classList.remove('hidden');
      document.getElementById('myProgressPage').classList.add('block');
      document.getElementById('allCoursesPage').classList.remove('block');
      document.getElementById('allCoursesPage').classList.add('hidden');
      
      // Render progress data
      renderProgressPage();
    }

    // Simple sidebar toggle function
    function setupSidebarToggle() {
      const sidebar = document.getElementById('sidebar');
      const sidebarToggle = document.getElementById('sidebarToggle');
      const expandButton = document.getElementById('expandButton');
      
      // Toggle sidebar collapsed state
      sidebarToggle.addEventListener('click', function() {
        sidebar.classList.add('collapsed');
        expandButton.classList.add('visible');
        
        // Save state
        localStorage.setItem('sidebarCollapsed', 'true');
      });
      
      // Expand sidebar when clicking expand button
      expandButton.addEventListener('click', function() {
        sidebar.classList.remove('collapsed');
        expandButton.classList.remove('visible');
        
        // Save state
        localStorage.setItem('sidebarCollapsed', 'false');
      });
      
      // Check for saved state on page load
      if (localStorage.getItem('sidebarCollapsed') === 'true') {
        sidebar.classList.add('collapsed');
        expandButton.classList.add('visible');
      }
    }

    document.addEventListener('DOMContentLoaded', () => {
      document.getElementById('navTitle').textContent = platformConfig.title;
      document.getElementById('platformTitle').textContent = platformConfig.pageTitle;
      document.title = platformConfig.title;
      
      // Set up navigation buttons
      document.getElementById('showAllCoursesBtn').addEventListener('click', showAllCourses);
      document.getElementById('showMyProgressBtn').addEventListener('click', showMyProgress);
      
      // Populate course tree
      populateCourseTree();
      
      setupSearch(); // Initialize search functionality
      renderCourses();
      
      // Add active-nav-item styling
      document.head.insertAdjacentHTML('beforeend', `
        <style>
          .active-nav-item {
            background-color: #f3f4f6;
            font-weight: 600;
            color: #111827 !important;
          }
        </style>
      `);

      // Add this line:
      setupSidebarToggle();
    });

    renderCourses();
  </script>
</body>
</html>